<div class="row">
    <div class="col-md-12">
        <div class="d-flex mb-2">
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle bt-option" type="button" id="dropdownMenuButton"
                    data-toggle="dropdown" aria-expanded="false">
                    Opções
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="#">Importar</a>
                    <a class="dropdown-item" href="#">Baixar Modelo</a>
                    <a class="dropdown-item" href="#">Remover</a>
                </div>
            </div>
            <input type="text" id="partnumber" class="form-control st-input-with-bt" placeholder="Buscar por número">
            <button class="bt-create btn btn-primary" (click)="openModal(template)"> <i class="fa fa-plus"></i>
                Novo</button>
        </div>
    </div>
</div>


<ng-template #template>

    <div class="col-md-12 d-flex justify-content-between modal-header-custom">

        <h5 class="modal-title pull-left"> <i class="fa fa-cube" aria-hidden="true"></i> {{titleModal}} Item</h5>

        <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
            <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>

    </div>
    <div class="mt-4">

        <div class="nav-tabs-navigation">

            <div class="nav-tabs-wrapper">
                <ul id="tabs" class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#descricao" role="tab"
                            aria-expanded="true">Descrição</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#fabricante" role="tab"
                            aria-expanded="true">Fabricante</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#classificacao" role="tab"
                            aria-expanded="false">Classificação</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#extarifarios" role="tab"
                            aria-expanded="false">Ex-tarifários</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#destinacao" role="tab"
                            aria-expanded="false">Destinação</a>
                    </li>

                </ul>
            </div>

        </div>
        <!--############################------------DESCRIÇÃO-----------############################-->
        <div id="my-tab-content" class="tab-content">

            <div class="tab-pane active" id="descricao" role="tabpanel" aria-expanded="false">
                <form [formGroup]="form">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-6">
                                <label>Part Number</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="partnumber"
                                        formControlName="partnumber" placeholder="Part Number" required>
                                    <small
                                        *ngIf="(formControl.partnumber.touched || submitted) && formControl.partnumber.errors?.required"
                                        class="text-danger">
                                        Part Number é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Código Interno</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="codigo_interno"
                                        formControlName="codigo_interno" placeholder="Código Interno">
                                </div>

                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <label>Unidade Organizacional</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="unidade_organizacional"
                                        formControlName="unidade_organizacional" placeholder="Unidade Organizacional">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Número do PO</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="numero_po"
                                        formControlName="numero_po" placeholder="Número do PO">
                                </div>
                            </div>

                        </div>
                        <div class="row mt-2">
                            <div class="col-md-12">
                                <label for="decricao_detalhada">Descrição</label>
                                <div class="form-group">
                                    <textarea class="form-control" id="decricao_detalhada"
                                        formControlName="decricao_detalhada" placeholder="Descrição detalhada do item"
                                        rows="6"></textarea>
                                    <small
                                        *ngIf="(formControl.decricao_detalhada.touched || submitted) && formControl.decricao_detalhada.errors?.required"
                                        class="text-danger">
                                        Descrição é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label>NCM</label>
                                <div class="form-group">

                                    <ng-select [items]="ncm$ | async" bindValue="codigo" [minTermLength]="minLengthTerm"
                                        (change)="onChange($event)" [loading]="ncmLoading"
                                        typeToSearchText="Por favor digite {{minLengthTerm}} ou mais caractéres"
                                        [typeahead]="ncmInput$" formControlName="ncm" placeholder="Selecione NCM...">

                                        <ng-template ng-option-tmp ng-label-tmp let-item="item">
                                            <span [innerHTML]="item.codigo_nome | boldSpan:regexStr"></span>

                                        </ng-template>

                                    </ng-select>
                                    <small
                                        *ngIf="(formControl.ncm.touched || submitted) && formControl.ncm.errors?.required"
                                        class="text-danger">
                                        NCM é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <label>Quantidade</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="quantidade"
                                        formControlName="quantidade">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Unidade</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="unidade"
                                        formControlName="unidade">
                                </div>
                            </div>

                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <label>Valor Unitário</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="valor_unitario"
                                        formControlName="valor_unitario">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Valor Total</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="valor_total"
                                        formControlName="valor_total">
                                </div>
                            </div>

                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <label>Peso Líquido</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="peso_liquido"
                                        formControlName="peso_liquido">
                                </div>
                            </div>

                        </div>
                    </div>
                </form>
            </div>
            <!--######################################################################################################################################-->
            <div class="tab-pane" id="fabricante" role="tabpanel" aria-expanded="false">
                <form [formGroup]="form">
                    <div class="col-md-12">
                        <div class="row ">
                            <div class="col-md-12">
                                <div class="form-group">

                                    <ng-select [items]="fornecedor$ | async" bindValue="id"
                                        [minTermLength]="minLengthTerm" [loading]="fornecedorLoading"
                                        typeToSearchText="Por favor digite {{minLengthTerm}} ou mais caractéres"
                                        [typeahead]="fornecedorInput$" formControlName="fornecedor"
                                        placeholder="Selecione o fornecedor">

                                        <ng-template ng-option-tmp ng-label-tmp let-item="item">
                                            <span [innerHTML]="item.nomeFantasia | boldSpan:regexStr"></span>

                                        </ng-template>

                                    </ng-select>
                                    <small
                                        *ngIf="(formControl.fornecedor.touched || submitted) && formControl.fornecedor.errors?.required"
                                        class="text-danger">
                                        Fornecedor é obrigatório <i>*</i>
                                    </small>

                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Logradouro</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="logradouro"
                                        formControlName="logradouro" required>
                                    <small
                                        *ngIf="(formControl.logradouro.touched || submitted) && formControl.logradouro.errors?.required"
                                        class="text-danger">
                                        Logradouro é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Número</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="numero"
                                        formControlName="numero">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Complemento</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="complemento"
                                        formControlName="complemento">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Bairro</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="bairro"
                                        formControlName="bairro">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label>CEP</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="cep" formControlName="cep">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Cidade</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="cidade"
                                        formControlName="cidade">
                                    <small
                                        *ngIf="(formControl.cidade.touched || submitted) && formControl.cidade.errors?.required"
                                        class="text-danger">
                                        Cidade é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Estado</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="estado"
                                        formControlName="estado">
                                    <small
                                        *ngIf="(formControl.estado.touched || submitted) && formControl.estado.errors?.required"
                                        class="text-danger">
                                        Estado é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>País</label>
                                <div class="form-group">

                                    <div class="form-group">
                                        <ng-select [items]="paises" bindLabel="nome" class="custom" bindValue="id"
                                            appendTo="body" formControlName="pais"
                                            placeholder="Selecione País"></ng-select>
                                    </div>
                                    <small
                                        *ngIf="(formControl.pais.touched || submitted) && formControl.pais.errors?.required"
                                        class="text-danger">
                                        País é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Código Interno</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="codigointerno"
                                        formControlName="codigointerno">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!--######################################################################################################################################-->
            <div class="tab-pane" id="classificacao" role="tabpanel" aria-expanded="false">
                <form [formGroup]="form">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-12">
                                <label>NCM</label>
                                <div class="form-group">

                                    <ng-select [items]="ncm$ | async" bindValue="codigo" [minTermLength]="minLengthTerm"
                                        (change)="onChange($event)" [loading]="ncmLoading"
                                        typeToSearchText="Por favor digite {{minLengthTerm}} ou mais caractéres"
                                        [typeahead]="ncmInput$" formControlName="ncm" placeholder="Selecione NCM...">

                                        <ng-template ng-option-tmp ng-label-tmp let-item="item">
                                            <span [innerHTML]="item.codigo_nome | boldSpan:regexStr"></span>

                                        </ng-template>

                                    </ng-select>
                                    <small
                                        *ngIf="(formControl.ncm.touched || submitted) && formControl.ncm.errors?.required"
                                        class="text-danger">
                                        NCM é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mt-2">
                                <label>NALADI</label>
                                <div class="form-group">

                                    <ng-select [items]="naladi$ | async" bindValue="codigo"
                                        [minTermLength]="minLengthTerm" [loading]="naladiLoading"
                                        typeToSearchText="Por favor digite {{minLengthTerm}} ou mais caractéres"
                                        [typeahead]="naladiInput$" formControlName="naladi"
                                        placeholder="Selecione NALADI...">

                                        <ng-template ng-option-tmp ng-label-tmp let-item="item">
                                            <span [innerHTML]="item.codigo_nome | boldSpan:regexStr"></span>

                                        </ng-template>

                                    </ng-select>

                                </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <label>Alíquota II</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="aliquota_ii"
                                        formControlName="aliquota_ii" currencyMask
                                        [options]="{ suffix : '%', prefix: '', thousands: '.', decimal: ',' , align: 'left'}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Alíquota IPI</label>
                                <div class="form-group">
                                    <input type="text" class="form-control" id="aliquota_ipi"
                                        formControlName="aliquota_ipi" currencyMask
                                        [options]="{ suffix : '%', prefix: '', thousands: '.', decimal: ',' , align: 'left'}">
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Alíquota PIS</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="aliquota_pis"
                                        formControlName="aliquota_pis" currencyMask
                                        [options]="{ suffix : '%', prefix: '', thousands: '.', decimal: ',' , align: 'left'}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Alíquota COFINS</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="aliquota_cofins"
                                        formControlName="aliquota_cofins" currencyMask
                                        [options]="{ suffix : '%', prefix: '', thousands: '.', decimal: ',' , align: 'left'}">
                                </div>

                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!--######################################################################################################################################-->
            <div class="tab-pane" id="extarifarios" role="tabpanel" aria-expanded="false">
                <form [formGroup]="form">
                    <div class="col-md-12"></div>
                </form>
            </div>
            <!--######################################################################################################################################-->
            <div class="tab-pane" id="destinacao" role="tabpanel" aria-expanded="false">
                <form [formGroup]="form">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-6">
                                <span class="subtitle-destinacao">Condição</span>
                                <hr class="dash">
                                <div class="form-check-radio">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="condicao"
                                            id="condicaoRadios1" value="option1"> Material usado
                                        <span class="form-check-sign"></span>
                                    </label>
                                </div>
                                <div class="form-check-radio">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="condicao"
                                            id="condicaoeRadios1" value="option2"> Bem sob encomenda
                                        <span class="form-check-sign"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <span class="subtitle-destinacao">Aplicação</span>
                                <hr class="dash">
                                <div class="form-check-radio">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="aplicacao"
                                            id="aplicacaoRadios1" value="option1"> Consumo
                                        <span class="form-check-sign"></span>
                                    </label>
                                </div>
                                <div class="form-check-radio">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="aplicacao"
                                            id="aplicacaoRadios1" value="option2"> Revenda
                                        <span class="form-check-sign"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <span class="subtitle-destinacao">Zona Franca de Manaus</span>
                                <hr class="dash">
                                <table class="table table-striped table-bordered" cellspacing="0" width="100%">
                                    <thead>
                                        <tr class="set-height">
                                            <td>Insc. Estadual</td>
                                            <td>NCM</td>
                                            <td>Produto ZFM</td>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <label>Destinação</label>
                                <div class="form-group">
                                    <ng-select [items]="listdestinacao" bindLabel="codigo_nome" class="custom"
                                        bindValue="id" appendTo="body" formControlName="destinacao"
                                        placeholder="-- Selecione --"></ng-select>
                                    <small
                                        *ngIf="(formControl.destinacao.touched || submitted) && formControl.destinacao.errors?.required"
                                        class="text-danger">
                                        Destinação é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Utilização</label>
                                <div class="form-group">
                                    <ng-select [items]="listutilizacao" bindLabel="codigo_nome" class="custom"
                                        bindValue="id" appendTo="body" formControlName="destinacao"
                                        placeholder="-- Selecione --"></ng-select>
                                    <small
                                        *ngIf="(formControl.utilizacao.touched || submitted) && formControl.utilizacao.errors?.required"
                                        class="text-danger">
                                        Utilização é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="row ">
                            <div class="col-md-3">
                                <label>Inscrição Estadual</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="insc_estadual"
                                        formControlName="insc_estadual">
                                    <small
                                        *ngIf="(formControl.insc_estadual.touched || submitted) && formControl.insc_estadual.errors?.required"
                                        class="text-danger">
                                        Inscrição Estadual é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label>Tributação</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="tributacao"
                                        formControlName="tributacao">
                                    <small
                                        *ngIf="(formControl.tributacao.touched || submitted) && formControl.tributacao.errors?.required"
                                        class="text-danger">
                                        Tributação é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label>Tributação FPS</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="tributacao_fps"
                                        formControlName="tributacao_fps">

                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <label>CRA</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="cra" formControlName="cra">
                                    <small
                                        *ngIf="(formControl.cra.touched || submitted) && formControl.cra.errors?.required"
                                        class="text-danger">
                                        CRA é obrigatório <i>*</i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-12">
                                <span class="subtitle-destinacao">Dados da NF-e</span>
                                <hr class="dash">
                                <div class="form-group">
                                    <textarea type="text" class="form-control" id="decricao_item"
                                        formControlName="decricao_item"
                                        placeholder="descrição do item para a NFe (opcional)" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-3">
                                <label>CFOP</label>
                                <div class="form-group">
                                    <input type="text" class="form-control input-custom" id="cfop"
                                        formControlName="cfop">

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!--######################################################################################################################################-->

        </div>

    </div>
    <div>
        <div class="col-md-12 d-flex justify-content-end mt-4 modal-footer-custom">

            <button type="button" class="btn btn-primary mt-4 mb-4" (click)="onSubmit()">
                <div *ngIf="isLoadSave" class="spinner-border spinner-border-sm text-light" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <span *ngIf="!isLoadSave">Salvar</span>
            </button>
        </div>
    </div>
</ng-template>